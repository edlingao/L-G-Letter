<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propuesta de Salud Visual - Instituto M√©xico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      body{
          line-height: initial !important;
      }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Print Button -->
    <div class="no-print flex justify-center gap-4 py-4">
        <button onclick="openSettingsModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition duration-300">
            ‚öôÔ∏è Configurar
        </button>
        <button onclick="generatePDF()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition duration-300">
            üìÑ Generar PDF
        </button>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md mx-auto">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-900 to-blue-600 text-white p-6 rounded-t-lg">
                <h2 class="text-xl font-bold">‚öôÔ∏è Configuraci√≥n del Documento</h2>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6 space-y-6">
                <!-- Recipient Field -->
                <div>
                    <label for="recipientName" class="block text-sm font-medium text-gray-700 mb-2">
                        Destinatario (Nombre de la organizaci√≥n)
                    </label>
                    <input 
                        type="text" 
                        id="recipientName" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                        placeholder="Ej: Instituto M√©xico"
                        value="Instituto M√©xico"
                    >
                </div>
                
                <!-- Organization Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Tipo de organizaci√≥n
                    </label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input 
                                type="radio" 
                                name="orgType" 
                                value="escuela" 
                                class="text-blue-600 focus:ring-blue-500 focus:ring-2"
                                checked
                            >
                            <span class="ml-2 text-gray-700">üè´ Escuela / Instituci√≥n Educativa</span>
                        </label>
                        <label class="flex items-center">
                            <input 
                                type="radio" 
                                name="orgType" 
                                value="empresa" 
                                class="text-blue-600 focus:ring-blue-500 focus:ring-2"
                            >
                            <span class="ml-2 text-gray-700">üè¢ Empresa / Organizaci√≥n</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex gap-3 p-6 pt-0">
                <button 
                    onclick="closeSettingsModal()" 
                    class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200"
                >
                    Cancelar
                </button>
                <button 
                    onclick="saveSettings()" 
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200"
                >
                    Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Flyer Content -->
    <div id="flyer" class="max-w-4xl mx-auto bg-white shadow-2xl">
        <!-- Header with Logo Space -->
        <div class="bg-gradient-to-r from-blue-900 to-blue-600 text-white p-8 space-y-4">
          <div class="flex justify-between items-center mb-6">
                <div class="w-48 h-16 rounded-lg flex items-center justify-start">
                  <img src="https://www.lg-optics.com/LG-OPTICS.png" alt="LG Optics Logo" class="h-full object-contain">
                </div>
                <div class="text-right">
                    <p class="text-sm opacity-90">DEPARTAMENTO CLUB DE BENEFICIOS</p>
                    <p class="text-xs opacity-75" data-recipient="true">Instituto M√©xico</p>
                </div>
            </div>
            <h1 class="text-4xl font-bold mb-2">PROPUESTA DE SERVICIO</h1>
            <h2 class="text-5xl font-extrabold">üëÅÔ∏è SALUD VISUAL</h2>
            <div class="mt-4 bg-white/20 rounded-full inline-block px-6 py-2">
                <p class="text-lg font-semibold" data-para-personal="true">Para Personal de Instituto M√©xico</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="p-8">
            <!-- Introduction Section -->
            <div class="bg-blue-50 rounded-lg p-6 mb-8 border-l-4 border-blue-600">
                <h3 class="text-xl font-bold text-blue-900 mb-3">üìö LA IMPORTANCIA DE LA SALUD VISUAL EN EL √ÅMBITO LABORAL</h3>
                <p class="text-gray-700 leading-relaxed text-sm">
                    La salud visual representa uno de los pilares fundamentales para el √≥ptimo desempe√±o laboral, especialmente en el sector educativo. Un personal con visi√≥n saludable mejora su calidad de vida, incrementa su productividad y optimiza los procesos educativos.
                </p>
            </div>

            <!-- Service Proposal -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-blue-900 mb-6 text-center">
                    ‚ú® SERVICIO INTEGRAL SIN COSTO PARA LA <span data-institucion="true">INSTITUCI√ìN</span> ‚ú®
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Phase 1 -->
                    <div class="bg-gradient-to-b from-sky-100 to-sky-50 rounded-lg p-6 border-t-4 border-sky-600">
                        <div class="text-center mb-4">
                            <div class="bg-sky-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2 text-xl font-bold mx-auto my-auto">1</div>
                            <h4 class="text-lg font-bold text-sky-800">FASE I: EVALUACI√ìN INTEGRAL üîç</h4>
                        </div>
                        <ul class="text-sm text-gray-700 space-y-2">
                            <li class="flex items-start">
                                <span class="text-sky-600 mr-2">‚úì</span>
                                Examen visual completo
                            </li>
                            <li class="flex items-start">
                                <span class="text-sky-600 mr-2">‚úì</span>
                                Detecci√≥n de defectos refractivos
                            </li>
                            <li class="flex items-start">
                                <span class="text-sky-600 mr-2">‚úì</span>
                                Evaluaci√≥n de salud ocular
                            </li>
                        </ul>
                    </div>

                    <!-- Phase 2 -->
                    <div class="bg-gradient-to-b from-blue-100 to-blue-50 rounded-lg p-6 border-t-4 border-blue-600">
                        <div class="text-center mb-4">
                            <div class="bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2 text-xl font-bold">2</div>
                            <h4 class="text-lg font-bold text-blue-800">FASE II: CORRECCI√ìN Y TRATAMIENTO üëì</h4>
                        </div>
                        <ul class="text-sm text-gray-700 space-y-2">
                            <li class="flex items-start">
                                <span class="text-blue-600 mr-2">‚úì</span>
                                Prescripci√≥n de lentes
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-600 mr-2">‚úì</span>
                                Higiene visual laboral
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-600 mr-2">‚úì</span>
                                Seguimiento peri√≥dico
                            </li>
                        </ul>
                    </div>

                    <!-- Phase 3 -->
                    <div class="bg-gradient-to-b from-indigo-100 to-indigo-50 rounded-lg p-6 border-t-4 border-indigo-600">
                        <div class="text-center mb-4">
                            <div class="bg-indigo-600 text-white rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2 text-xl font-bold">3</div>
                            <h4 class="text-lg font-bold text-indigo-800">FASE III: CAPACITACI√ìN üìñ</h4>
                        </div>
                        <ul class="text-sm text-gray-700 space-y-2">
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                Ergonom√≠a visual
                            </li>
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                Protocolo de descansos
                            </li>
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                Material informativo
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Benefits -->
            <div class="bg-gradient-to-r from-blue-900 to-blue-700 text-white rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold mb-4 text-center">üéØ BENEFICIOS DIRECTOS PARA LA <span data-institucion="true">INSTITUCI√ìN</span></h3>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-3xl font-bold mb-1">üìà</div>
                        <p class="text-sm">Incremento en Productividad</p>
                    </div>
                    <div>
                        <div class="text-3xl font-bold mb-1">üí∞</div>
                        <p class="text-sm">Reducci√≥n de Costos</p>
                    </div>
                    <div>
                        <div class="text-3xl font-bold mb-1">üòä</div>
                        <p class="text-sm">Mejora del Clima Laboral</p>
                    </div>
                </div>
            </div>

            <!-- Call to Action -->
            <div class="bg-sky-50 rounded-lg p-6 text-center border-2 border-sky-200">
                <h3 class="text-xl font-bold text-blue-900 mb-3">üöÄ INVITACI√ìN A LA ACCI√ìN</h3>
                <p class="text-gray-700 mb-4">
                    La salud visual de su personal representa una inversi√≥n estrat√©gica en el futuro de su <span data-institucion-educativa="true">instituci√≥n educativa</span>.
                </p>
                <p class="text-lg font-semibold text-blue-800 mb-4">
                    üìÖ ¬øCu√°ndo podemos agendar una reuni√≥n para detallar la implementaci√≥n?
                </p>
                <div class="bg-white rounded-full inline-block px-8 py-3 shadow-md">
                    <p class="text-blue-600 font-medium italic">
                        "Porque una visi√≥n clara construye un futuro brillante para su <span data-institucion-educativa="true">instituci√≥n educativa</span>" ‚ú®
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-100 p-4 text-center text-sm text-gray-600">
          <p>üëÅÔ∏è √ìptica Profesional ‚Ä¢ üìç Puebla, M√©xico ‚Ä¢ üìß linaresygaona@gmail.com ‚Ä¢ üìû (221) 337-4152</p>
        </div>
    </div>

    <style>
        @media print {
            body { margin: 0; }
            .no-print { display: none; }
        }
    </style>
    <script>
        // Settings management
        let currentSettings = {
            recipient: 'Instituto M√©xico',
            orgType: 'escuela'
        };

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('documentSettings');
            if (saved) {
                currentSettings = JSON.parse(saved);
                updateContent();
            }
        }

        // Save settings to localStorage
        function saveSettingsToStorage() {
            localStorage.setItem('documentSettings', JSON.stringify(currentSettings));
        }

        // Update content based on current settings
        function updateContent() {
            // Update recipient name
            const recipientElements = document.querySelectorAll('[data-recipient="true"]');
            recipientElements.forEach(el => {
                el.textContent = currentSettings.recipient;
            });

            // Update "Para Personal de [recipient]"
            const paraPersonalElements = document.querySelectorAll('[data-para-personal="true"]');
            paraPersonalElements.forEach(el => {
                el.textContent = `Para Personal de ${currentSettings.recipient}`;
            });

            // Update institution/organization terminology
            const institucionElements = document.querySelectorAll('[data-institucion="true"]');
            const institucionEducativaElements = document.querySelectorAll('[data-institucion-educativa="true"]');
            
            if (currentSettings.orgType === 'empresa') {
                institucionElements.forEach(el => {
                    el.textContent = 'ORGANIZACI√ìN';
                });
                institucionEducativaElements.forEach(el => {
                    el.textContent = 'organizaci√≥n';
                });
            } else {
                institucionElements.forEach(el => {
                    el.textContent = 'INSTITUCI√ìN';
                });
                institucionEducativaElements.forEach(el => {
                    el.textContent = 'instituci√≥n educativa';
                });
            }
        }

        // Modal functions
        function openSettingsModal() {
            // Load current settings into form
            document.getElementById('recipientName').value = currentSettings.recipient;
            document.querySelector(`input[name="orgType"][value="${currentSettings.orgType}"]`).checked = true;
            
            // Show modal
            document.getElementById('settingsModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Focus on the first input
            setTimeout(() => {
                document.getElementById('recipientName').focus();
                document.getElementById('recipientName').select();
            }, 100);
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function saveSettings() {
            // Get form values
            const recipient = document.getElementById('recipientName').value.trim();
            const orgType = document.querySelector('input[name="orgType"]:checked').value;
            
            // Validation
            if (!recipient) {
                alert('Por favor, ingrese el nombre del destinatario.');
                return;
            }
            
            // Update settings
            currentSettings.recipient = recipient;
            currentSettings.orgType = orgType;
            
            // Save and update
            saveSettingsToStorage();
            updateContent();
            closeSettingsModal();
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('settingsModal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeSettingsModal();
                }
            });
            
            // Load settings on page load
            loadSettings();
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSettingsModal();
            }
        });

        async function generatePDF() {
            const element = document.getElementById('flyer');
            const button = document.querySelector('button');
            button.disabled = true;
            button.textContent = 'Generando PDF...';
            
            try {
                // Clone the element for manipulation
                const clonedElement = element.cloneNode(true);
                document.body.appendChild(clonedElement);
                clonedElement.style.position = 'fixed';
                clonedElement.style.top = '0';
                clonedElement.style.left = '0';
                clonedElement.style.width = '850px'; // Slightly wider for better proportions
                clonedElement.style.maxWidth = '850px';
                clonedElement.style.zIndex = '-9999';
                clonedElement.style.backgroundColor = 'white';
                
                // Fix all number badges
                const allRoundedDivs = clonedElement.querySelectorAll('div.rounded-full.w-12.h-12');
                allRoundedDivs.forEach(badge => {
                    const text = badge.textContent.trim();
                    if (text === '1' || text === '2' || text === '3') {
                        // Get the original background color
                        let bgColor = '#2563eb'; // default blue
                        if (badge.classList.contains('bg-sky-600')) {
                            bgColor = '#0284c7';
                        } else if (badge.classList.contains('bg-blue-600')) {
                            bgColor = '#2563eb';
                        } else if (badge.classList.contains('bg-indigo-600')) {
                            bgColor = '#4f46e5';
                        }
                        
                        // Apply inline styles to force centering
                        badge.style.cssText = `
                            width: 48px !important;
                            height: 48px !important;
                            border-radius: 50% !important;
                            background-color: ${bgColor} !important;
                            color: white !important;
                            display: flex !important;
                            align-items: center !important;
                            justify-content: center !important;
                            margin: 0 auto 8px auto !important;
                            font-size: 20px !important;
                            font-weight: bold !important;
                            line-height: 1 !important;
                            padding: 0 !important;
                        `;
                        
                        // Wrap content in span for better centering
                        badge.innerHTML = `<span style="display: block; text-align: center;">${text}</span>`;
                    }
                });
                
                // Fix parent container of number badges to ensure centering
                const phaseContainers = clonedElement.querySelectorAll('.text-center.mb-4');
                phaseContainers.forEach(container => {
                    container.style.cssText = `
                        text-align: center !important;
                        margin-bottom: 16px !important;
                        display: flex !important;
                        flex-direction: column !important;
                        align-items: center !important;
                    `;
                });
                
                // Fix text centering for all centered elements
                const centeredTexts = clonedElement.querySelectorAll('.text-center');
                centeredTexts.forEach(el => {
                    el.style.textAlign = 'center';
                    // Also center flex items if they contain the badges
                    if (el.querySelector('.rounded-full')) {
                        el.style.display = 'flex';
                        el.style.flexDirection = 'column';
                        el.style.alignItems = 'center';
                    }
                });
                
                // Specifically target the phase titles
                const phaseTitles = clonedElement.querySelectorAll('h4.text-lg.font-bold');
                phaseTitles.forEach(title => {
                    title.style.textAlign = 'center';
                    title.style.width = '100%';
                });
                
                // Wait for styles to apply
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // Use html2canvas to capture the element
                const canvas = await html2canvas(clonedElement, {
                    scale: 2.5, // Good quality without being too heavy
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff',
                    width: 850,
                    height: clonedElement.scrollHeight,
                    windowWidth: 850,
                    windowHeight: clonedElement.scrollHeight
                });
                
                // Remove cloned element
                document.body.removeChild(clonedElement);
                
                // Create PDF - full page without margins
                const pdf = new jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'pt',
                    format: 'a4'
                });
                
                // A4 dimensions in points (no margins)
                const pageWidth = 595.28;
                const pageHeight = 841.89;
                
                // Calculate dimensions to fill the page
                let finalWidth = pageWidth;
                let finalHeight = (canvas.height * finalWidth) / canvas.width;
                
                // If height exceeds page, scale to fit
                if (finalHeight > pageHeight) {
                    finalHeight = pageHeight;
                    finalWidth = (canvas.width * finalHeight) / canvas.height;
                    // Center horizontally if width is less than page width
                    const xOffset = (pageWidth - finalWidth) / 2;
                    pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', xOffset, 0, finalWidth, finalHeight);
                } else {
                    // Fill width, add from top
                    pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, 0, finalWidth, finalHeight);
                }
                
                // Generate filename based on organization name
                const sanitizedName = currentSettings.recipient
                    .toLowerCase()
                    .replace(/[^a-z0-9]/g, '-')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '');
                
                // Save the PDF
                pdf.save(`propuesta-salud-visual-${sanitizedName}.pdf`);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error al generar el PDF. Por favor, intente nuevamente.');
            } finally {
                button.disabled = false;
                button.textContent = 'üìÑ Generar PDF';
            }
        }
    </script>
</body>
</html>
